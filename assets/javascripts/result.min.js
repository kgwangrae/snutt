/* 2015-01-04 */ function SHA1(a){function b(a,b){var c=a<<b|a>>>32-b;return c}function c(a){var b,c,d="";for(b=7;b>=0;b--)c=a>>>4*b&15,d+=c.toString(16);return d}function d(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var e,f,g,h,i,j,k,l,m,n=new Array(80),o=1732584193,p=4023233417,q=2562383102,r=271733878,s=3285377520;a=d(a);var t=a.length,u=new Array;for(f=0;t-3>f;f+=4)g=a.charCodeAt(f)<<24|a.charCodeAt(f+1)<<16|a.charCodeAt(f+2)<<8|a.charCodeAt(f+3),u.push(g);switch(t%4){case 0:f=2147483648;break;case 1:f=a.charCodeAt(t-1)<<24|8388608;break;case 2:f=a.charCodeAt(t-2)<<24|a.charCodeAt(t-1)<<16|32768;break;case 3:f=a.charCodeAt(t-3)<<24|a.charCodeAt(t-2)<<16|a.charCodeAt(t-1)<<8|128}for(u.push(f);u.length%16!=14;)u.push(0);for(u.push(t>>>29),u.push(t<<3&4294967295),e=0;e<u.length;e+=16){for(f=0;16>f;f++)n[f]=u[e+f];for(f=16;79>=f;f++)n[f]=b(n[f-3]^n[f-8]^n[f-14]^n[f-16],1);for(h=o,i=p,j=q,k=r,l=s,f=0;19>=f;f++)m=b(h,5)+(i&j|~i&k)+l+n[f]+1518500249&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;for(f=20;39>=f;f++)m=b(h,5)+(i^j^k)+l+n[f]+1859775393&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;for(f=40;59>=f;f++)m=b(h,5)+(i&j|i&k|j&k)+l+n[f]+2400959708&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;for(f=60;79>=f;f++)m=b(h,5)+(i^j^k)+l+n[f]+3395469782&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;o=o+h&4294967295,p=p+i&4294967295,q=q+j&4294967295,r=r+k&4294967295,s=s+l&4294967295}var m=c(o)+c(p)+c(q)+c(r)+c(s);return m.toLowerCase()}function trim(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function isArray(a){return"[object Array]"==Object.prototype.toString.call(a)}function export_timetable(){if(!ctx)return void alert("오류가 발생했습니다. 잠시 뒤 다시 시도해주세요.");ctx.drawImage(bg_image,0,0,bg_image.width,bg_image.height),draw_timetable(),$(".timetable-image").remove();var a=new Image;a.src=canvas.toDataURL("image/png"),$(a).appendTo($("#export_image_wrapper")).addClass("timetable-image"),$("#export_save_button").attr("href",a.src)}function set_rect_style(a){ctx.strokeStyle=a.border,ctx.fillStyle=a.plane,ctx.lineWidth=line_width}function get_x(a){var b=a[0],c="일월화수목금토";return{x:line_horizontal[c.indexOf(b)]+line_width/2+1,length:line_horizontal[c.indexOf(b)+1]-line_horizontal[c.indexOf(b)]-line_width}}function get_y(a){var b=parseInt(2*parseFloat(a.replace(/[()]/g,"").split("-")[0].slice(1))),c=parseInt(2*parseFloat(a.replace(/[()]/g,"").split("-")[1])),d=b+c;return{y:line_vertical[b+1]+line_width/2+1,length:line_vertical[d+1]-line_vertical[b+1]-line_width}}function roundRect(a,b,c,d,e,f,g,h){"undefined"==typeof h&&(h=!0),"undefined"==typeof f&&(f=5),a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath(),h&&a.stroke(),g&&a.fill()}function draw_lecture(a){for(var b=a.class_time.split("/"),c=a.location.split("/"),d=0;d<b.length;d++){var e=b[d],f=get_x(e),g=get_y(e),h={plane:a.color.plane,border:a.color.plane};set_rect_style(h),roundRect(ctx,f.x,g.y,f.length,g.length,5,!0,!0);var i=14;ctx.textAlign="center",ctx.font="9pt Nanum Gothic",console.log(a.color),ctx.fillStyle=a.color.border;var j=wrapText(ctx,a.course_title,f.x+2+f.length/2,g.y+g.length/2-i/4,f.length,i);wrapText(ctx,c[d],f.x+2+f.length/2,j+i,f.length,i)}}function draw_timetable(){for(var a=0;a<my_lectures.length;a++)draw_lecture(my_lectures[a])}function wrapText(a,b,c,d,e,f){for(var g=b.split(" "),h="",i=0;i<g.length;i++){var j=h+g[i]+" ",k=a.measureText(j),l=k.width;l>e?(a.fillText(h,c,d),h=g[i]+" ",d+=f):h=j}return a.fillText(h,c,d),d}function supports_canvas(){return!!document.createElement("canvas").getContext}function supportsToDataURL(){if(!supports_canvas())return!1;var a=document.createElement("canvas"),b=a.toDataURL("image/png");return 0==b.indexOf("data:image/png")}function simplify_class_time(a){return a.replace(/-[\d.,]*\)/g,")").replace(/,[\d.,]*\)/g,")").replace(/[()]/g,"")}function simplify_location(a){for(var b=a.split("/"),c=0;c<b.length-1;c++)for(var d=c+1;d<b.length;d++)b[c]==b[d]&&(b.splice(d,1),d=c);return b.join("<br />")}function already_owned_lecture(a){for(var b=0;b<my_lectures.length;b++)if(is_equal_lecture(my_lectures[b],a))return!0;return!1}function already_exist_class_time(a){for(var b=0;b<my_lectures.length;b++)if(is_duplicated_class_time(a,my_lectures[b]))return!0;return!1}function is_duplicated_class_time(a,b){function c(a,b,c){return b>a&&c>b?!0:!1}for(var d=a.class_time.split("/"),e=b.class_time.split("/"),f=0;f<d.length;f++)for(var g=0;g<e.length;g++){var h=d[f].charAt(0),i=e[g].charAt(0),j=d[f].replace(/[()]/g,"").slice(1).split("-"),k=e[g].replace(/[()]/g,"").slice(1).split("-"),l=parseFloat(j[0]),m=parseFloat(k[0]),n=parseFloat(j[1]),o=parseFloat(k[1]);if(h==i&&(c(l,m,l+n)||c(l,m+o,l+n)||c(m,l,m+o)||c(m,l+n,m+o)||l==m&&n==o))return!0}return!1}function semester_to_text(a){return"1"==a?"1학기":"2"==a?"2학기":"S"==a?"여름학기":"W"==a?"겨울학기":"null"}function get_coursebook_info(a,b){for(var c=0;c<coursebook_info.length;c++){var d=coursebook_info[c];if(d.year==a&&d.semester==b)return d}return null}function change_semester(a,b){current_year=a,current_semester=b,$("#semester_label").text(current_year+"-"+current_semester),$("#data_updated_at").text(get_coursebook_info(current_year,current_semester).updated_time),$("#search_query_text").focus().val("")}function generate_custom_cell(a){var b=($("#timetable tbody td").width()+2,$("#timetable tbody td").height()+.75,$("#timetable tbody th").width()+2,$("#timetable thead th").height()+2),c=2;if(-1==wday_to_num(a.class_time.charAt(0)))return void console.log("User tried to generate timetables with invalid class time");var d,e=a.class_time,f=wday_to_num(e.charAt(0)),g=2*parseFloat(e.replace(/[()]/g,"").split("-")[0].slice(1)),h=2*parseFloat(e.replace(/[()]/g,"").split("-")[1]),i=$($("#timetable td")[6*g+f]),j=$($("#timetable td")[6*(g+h-1)+f]);d=5==f||4==f?i.prev():i.next();{var k=Math.abs(d.position().left-i.position().left)-c,l=j.position().top-i.position().top+j.innerHeight()-0*c,m=i.position().left-i.parent().position().left-c/2,n=i.position().top-i.parent().parent().position().top+b-c/2;$("#customcell").css("left",m).css("top",n).width(k).height(l).show()}}function set_scroll_to_selected_row(){if(selected_row){var a=selected_row.position().top-selected_row.parent().position().top+26-110;$("#lectures_content").scrollTop(a)}}function set_scroll_to_my_courses_selected_row(){if(my_courses_selected_row){var a=my_courses_selected_row.position().top-my_courses_selected_row.parent().position().top+26-110;$("#lectures_content").scrollTop(a)}}function wday_to_num(a){return"월"==a?0:"화"==a?1:"수"==a?2:"목"==a?3:"금"==a?4:"토"==a?5:-1}function generate_random_color(a){if(!a)return colors[Math.floor(colors.length*Math.random())];for(var b=colors[Math.floor(colors.length*Math.random())];b.plane==a.plane;)b=colors[Math.floor(colors.length*Math.random())];return b}function generate_next_color(a){var b;for(b=0;b<colors.length;b++)if(a==colors[b])return colors[(b+1)%colors.length]}function my_course_tooltip_message(a){$(".my-course-tooltip .tooltip-inner").text(a),$(".my-course-tooltip").hide().stop(!0,!0).fadeIn(500,function(){$(".my-course-tooltip").stop(!0,!0).animate({color:"#fff"},1e3,function(){$(".my-course-tooltip").stop(!0,!0).fadeOut(500)})})}function search_filter_tooltip_message(a){$(".search-filter-tooltip .tooltip-inner").text(a),$(".search-filter-tooltip").hide().stop(!0,!0).fadeIn(500,function(){$(".search-filter-tooltip").stop(!0,!0).animate({color:"#fff"},1e3,function(){$(".search-filter-tooltip").stop(!0,!0).fadeOut(500)})})}function remove_lecture_from_my_lectures(a){if(a){a.color=null;for(var b=0;b<my_lectures.length;b++)if(is_equal_lecture(my_lectures[b],a)){my_lectures.splice(b,1);break}refresh_my_courses_table(),generate_timecell(my_lectures),my_course_tooltip_message("강의가 제거되었습니다.")}}function is_equal_lecture(a,b){return a.course_number==b.course_number&&a.lecture_number==b.lecture_number?!0:!1}function get_lecture_by_course_number(a,b){for(var c=0;c<lectures.length;c++)if(s(lectures[c].course_number)==s(a)&&s(lectures[c].lecture_number)==s(b))return lectures[c];return null}function get_my_lecture_by_course_number(a,b){for(var c=0;c<my_lectures.length;c++)if(s(my_lectures[c].course_number)==s(a)&&s(my_lectures[c].lecture_number)==s(b))return my_lectures[c];return null}function is_equal_timecell(a,b){return a.attr("course-number")==b.attr("course-number")&&a.attr("lecture-number")==b.attr("lecture-number")}function for_equal_lecture_timecells(a,b){$(".timecell").each(function(){var c=$(this);is_equal_timecell(a,c)&&b(c)})}function generate_timecell(a){$(".timecell-container").remove();for(var b=($("#timetable_container td.mon").outerWidth(),$("#timetable_container td.mon").outerHeight(),$("#timetable tbody th").outerWidth(),$("#timetable thead th").outerHeight()),c=1,d=0;d<a.length;d++){var e=a[d];if(-1!=wday_to_num(e.class_time.charAt(0))){e.color||generate_random_color(e.color);for(var f=e.class_time.split("/"),g=e.location.split("/"),h=0;h<f.length;h++){var i,j=wday_to_num(f[h].charAt(0)),k=2*parseFloat(f[h].replace(/[()]/g,"").split("-")[0].slice(1)),l=2*parseFloat(f[h].replace(/[()]/g,"").split("-")[1]),m=$($("#timetable td")[6*k+j]),n=$($("#timetable td")[6*(k+l-1)+j]);i=5==j||4==j?m.prev():m.next();var o=Math.abs(i.position().left-m.position().left)+c,p=n.position().top-m.position().top+n.innerHeight()+2*c,q=m.position().left-m.parent().position().left,r=m.position().top-m.parent().parent().position().top+b,s=$("<div></div>").addClass("timecell-container").appendTo($("#timecells_container")),t=$("<div></div>").addClass("timecell").width(o).height(p).css("left",q).css("top",r).css("background-color",e.color.plane).css("color",e.color.border).appendTo(s),u=$('<div class="timecellinfo-containter">').appendTo(t);$("<span></span>").text(e.course_title).appendTo(u),$("<br />").appendTo(u),$("<span></span>").text(g[h]).appendTo(u),e.color==gray_color&&t.addClass("gray-cell"),t.attr("course-number",e.course_number).attr("lecture-number",e.lecture_number)}}}$(".gray-cell").click(function(){return selected_row&&row_dblclick_handler(selected_row),!1}),$(".timecell").click(function(){var a=$(this),b=get_my_lecture_by_course_number(a.attr("course-number"),a.attr("lecture-number"));b&&!a.hasClass("gray-cell")&&(b.color=generate_next_color(b.color),for_equal_lecture_timecells(a,function(a){a.css("background-color",b.color.plane).css("color",b.color.border)}))}),$(".timecell").addSwipeEvents().bind("doubletap",function(a){a.stopPropagation(),timecell_delete_handler($(this))}),isTouchDevice()||$(".timecell").hover(function(){for_equal_lecture_timecells($(this),function(a){a.append('<div class="close del_hover" style="position:absolute; top:1px; right:2px;">×</span>'),a.find(".del_hover").click(function(b){b.stopPropagation(),timecell_delete_handler(a)})})},function(){$(".del_hover").remove()})}function timecell_delete_handler(a){var b=get_my_lecture_by_course_number(a.attr("course-number"),a.attr("lecture-number")),c=confirm("["+b.course_title+"]를 시간표에서 제거하시겠습니까?");c&&remove_lecture_from_my_lectures(b)}function my_courses_row_click_handler(){my_courses_selected_row&&my_courses_selected_row.removeClass("selected");var a=$(this);a.addClass("selected"),my_courses_selected_row=a,$(".remove-course-button").remove();var b=my_courses_selected_row.find(".course-title"),c=$('<span class="badge badge-important">제거</span>').addClass("remove-course-button").appendTo(b);c.click(function(){my_courses_selected_row&&my_courses_selected_row.trigger("dblclick")});var d=my_courses_selected_row.find(".mobile-info");c=$('<span class="badge badge-important">제거</span>').addClass("remove-course-button").appendTo(d),c.click(function(){my_courses_selected_row&&my_courses_selected_row.trigger("dblclick")});var e=get_my_lecture_by_course_number(a.attr("course-number"),a.attr("lecture-number"));e.color||(e.color=gray_color),generate_timecell(my_lectures.concat([e])),refresh_course_detail(e)}function row_click_handler(){selected_row&&selected_row.removeClass("selected");var a=$(this);a.addClass("selected"),selected_row=a,$(".add-course-button").remove();var b=selected_row.find(".course-title"),c=$('<span class="badge badge-success">추가</span>').addClass("add-course-button").appendTo(b);c.click(function(){selected_row&&selected_row.trigger("dblclick")});var d=selected_row.find(".mobile-info");c=$('<span class="badge badge-success">추가</span>').addClass("add-course-button").appendTo(d),c.click(function(){selected_row&&selected_row.trigger("dblclick")});var e=get_lecture_by_course_number(a.attr("course-number"),a.attr("lecture-number"));e.color||(e.color=gray_color),generate_timecell(my_lectures.concat([e])),refresh_course_detail(e)}function my_courses_row_dblclick_handler(a){var b=get_my_lecture_by_course_number(a.attr("course-number"),a.attr("lecture-number"));remove_lecture_from_my_lectures(b)}function row_dblclick_handler(a){var b=get_lecture_by_course_number(a.attr("course-number"),a.attr("lecture-number"));b&&(already_owned_lecture(b)?alert("이미 넣은 강의입니다."):already_exist_class_time(b)?alert("강의시간이 겹칩니다."):(b.color=generate_random_color(b.color),my_lectures.push(b),generate_timecell(my_lectures),refresh_my_courses_table(),my_course_tooltip_message("강의가 추가되었습니다.")))}function cancel_lecture_selection(){$(".selected").removeClass("selected"),$(".add-course-button").remove(),$(".remove-course-button").remove(),selected_row=null,my_courses_selected_row=null,generate_timecell(my_lectures),$("#course_detail_wrapper").fadeOut()}function isTouchDevice(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}}function touchScroll(a){if(isTouchDevice()){var b=(document.getElementById(a),0);document.getElementById(a).addEventListener("touchstart",function(a){b=this.scrollTop+a.touches[0].pageY},!1),document.getElementById(a).addEventListener("touchmove",function(a){this.scrollTop=b-a.touches[0].pageY,a.preventDefault()},!1)}}function s(a){return a?String(a):""}function course_detail_plan_button_handler(){var a=$(this);show_course_detail({year:current_year,semester:current_semester,course_number:a.attr("course-number"),lecture_number:a.attr("lecture-number")})}function set_dropdown_handler(){$("#stype_course_title").click(function(){$("#stype_dropdown_label").text("과목 이름"),$("#search_query_text").attr("placeholder","예) 수및연"),search_type="course_title",$("#search_query_text").focus().val("")}),$("#stype_instructor").click(function(){$("#stype_dropdown_label").text("교수명"),$("#search_query_text").attr("placeholder","예) 아이유"),search_type="instructor",$("#search_query_text").focus().val("")}),$("#stype_course_number").click(function(){$("#stype_dropdown_label").text("과목 번호"),$("#search_query_text").attr("placeholder","예) 4190.310 001"),search_type="course_number",$("#search_query_text").focus().val("")}),$("#stype_class_time").click(function(){$("#stype_dropdown_label").text("수업교시"),$("#search_query_text").attr("placeholder","예) 월1,5, 월6, 금"),search_type="class_time",$("#search_query_text").focus().val("")}),$("#stype_department").click(function(){$("#stype_dropdown_label").text("개설학과"),$("#search_query_text").attr("placeholder","예) 컴공"),search_type="department",$("#search_query_text").focus().val("")})}function get_filter(){if("off"==$("#search_filter_toggle_button").attr("state"))return null;var a={},b=[];$("#filter_academic_year .label-info").each(function(){b.push($(this).attr("value"))}),b.length>0&&(a.academic_year=b);var c=[];$("#filter_credit .label-info").each(function(){c.push($(this).attr("value"))}),c.length>0&&(a.credit=c);var d=[];$("#filter_basics .label-info").each(function(){d.push($(this).attr("value"))}),d.length>0&&(a.basics=d);var e=[];$("#filter_core .label-info").each(function(){e.push($(this).attr("value"))}),e.length>0&&(a.core=e);var f=[];return $("#filter_etc .label-info").each(function(){f.push($(this).attr("value"))}),f.length>0&&(a.etc=f),a}function refresh_course_detail(a){$("#course_detail_wrapper #course_detail_title").text(s(a.course_title)+" "+s(a.lecture_number)+" "+s(a.instructor)),$("#course_detail_wrapper .remark").text(s(a.remark)),$("#course_detail_plan_button").attr("course-number",a.course_number),$("#course_detail_plan_button").attr("lecture-number",a.lecture_number),$("#course_detail_wrapper").fadeIn()}function category_to_text(a){return"basics"==a?"학문의 기초 - 학문의 기초":"basics_foreign"==a?"학문의 기초 - 외국어와 외국문화":"basics_korean"==a?"학문의 기초 - 국어와 작문":"basics_science"==a?"학문의 기초 - 기초과학":"core_art"==a?"핵심교양 - 문학과 예술":"core_biology"==a?"핵심교양 - 생명과 환경":"core_history"==a?"핵심교양 - 역사와 철학":"core_nature"==a?"핵심교양 - 자연의 이해":"core_society"==a?"핵심교양 - 사회와 이념":"core_technology"==a?"핵심교양 - 자연과 기술":"normal_art"==a?"일반교양 - 문학과 예술":"normal_exercise"==a?"일반교양 - 체육 및 기타":"normal_foreign"==a?"일반교양 - 외국어와 외국문화":"normal_history"==a?"일반교양 - 역사와 철학":"normal_korean"==a?"일반교양 - 국어와 작문":"normal_nature"==a?"일반교양 - 자연의 이해":"normal_science"==a?"일반교양 - 기초과학":"normal_society"==a?"일반교양 - 사회와 이념":"normal_special"==a?"일반교양 - 기초교육 특별프로그램":a}function refresh_my_courses_table(){$("#my_courses_table tbody").children().remove();for(var a=0,b=0;b<my_lectures.length;b++){var c=my_lectures[b];a+=parseInt(c.credit);var d=$("<tr></tr>").attr("course-number",c.course_number).attr("lecture-number",c.lecture_number);$('<td class="hidden-xs"></td>').addClass("course-number").appendTo(d).text(c.course_number),$('<td class="hidden-xs"></td>').addClass("lecture-number").appendTo(d).text(c.lecture_number);{$('<td class="hidden-xs"></td>').addClass("course-title").appendTo(d).text(c.course_title+" ")}$('<td class="hidden-xs"></td>').addClass("classification").appendTo(d).text(c.classification),$('<td class="hidden-xs"></td>').addClass("department").appendTo(d).text(c.department),$('<td class="hidden-xs"></td>').addClass("academic-year").appendTo(d).text(c.academic_year),$('<td class="hidden-xs"></td>').addClass("credit").appendTo(d).text(c.credit),$('<td class="hidden-xs"></td>').addClass("class-time").appendTo(d).text(simplify_class_time(c.class_time)),$('<td class="hidden-xs"></td>').addClass("location").appendTo(d).html(simplify_location(c.location)),$('<td class="hidden-xs"></td>').addClass("instructor").appendTo(d).text(c.instructor),$('<td class="hidden-xs"></td>').addClass("quota").appendTo(d).text(c.quota);var e="<b>"+c.course_title+"</b>";c.instructor&&(e+=" / <b>"+c.instructor+"</b>"),e+=" / "+c.course_number+", "+c.lecture_number,e+=" / "+c.credit+"학점",e+=" / "+c.department+" "+c.academic_year+" "+c.classification,e+=" / 정원 "+c.quota+"명",$('<td class="mobile-info visible-xs"></td>').appendTo(d).html(e),d.appendTo($("#my_courses_table tbody")),d.click(my_courses_row_click_handler),d.dblclick(function(){my_courses_row_dblclick_handler($(this))}),d.addSwipeEvents().bind("doubletap",function(){my_courses_row_dblclick_handler($(this))})}if(0==my_lectures.length){var d=$("<tr></tr>").appendTo($("#my_courses_table tbody"));$('<td colspan="13"><h2>선택된 강의가 없습니다.</h2></td>').appendTo(d).css("text-align","center")}$(".badge-info").text(a+"학점"),my_courses_selected_row=null,selected_row&&(selected_row.removeClass("selected"),$("#course_detail_wrapper").fadeOut())}function set_result_table(a){1==a.page&&($("#search_result_table tbody").children().remove(),$("#lectures_content").scrollTop(0),selected_row&&selected_row.removeClass("selected"),selected_row=null,lectures=[]),lectures=lectures.concat(a.lectures);for(var b=0;b<a.lectures.length;b++){var c=a.lectures[b],d=$("<tr></tr>").attr("course-number",c.course_number).attr("lecture-number",c.lecture_number);$('<td class="hidden-xs"></td>').addClass("course-number").appendTo(d).text(c.course_number),$('<td class="hidden-xs"></td>').addClass("lecture-number").appendTo(d).text(c.lecture_number);{$('<td class="hidden-xs"></td>').addClass("course-title").appendTo(d).text(c.course_title+" ")}$('<td class="hidden-xs"></td>').addClass("classification").appendTo(d).text(c.classification),$('<td class="hidden-xs"></td>').addClass("department").appendTo(d).text(c.department),$('<td class="hidden-xs"></td>').addClass("academic-year").appendTo(d).text(c.academic_year),$('<td class="hidden-xs"></td>').addClass("credit").appendTo(d).text(c.credit),$('<td class="hidden-xs"></td>').addClass("class-time").appendTo(d).text(simplify_class_time(c.class_time)),$('<td class="hidden-xs"></td>').addClass("location").appendTo(d).html(simplify_location(c.location)),$('<td class="hidden-xs"></td>').addClass("instructor").appendTo(d).text(c.instructor),$('<td class="hidden-xs"></td>').addClass("quota").appendTo(d).text(c.quota);var e="<b>"+c.course_title+"</b>";c.instructor&&(e+=" / <b>"+c.instructor+"</b>"),e+=" / "+c.course_number+", "+c.lecture_number,e+=" / "+c.credit+"학점",e+=" / "+c.department+" "+c.academic_year+" "+c.classification,e+=" / 정원 "+c.quota+"명",$('<td class="mobile-info visible-xs"></td>').appendTo(d).html(e),d.appendTo($("#search_result_table tbody")),d.click(row_click_handler),d.dblclick(function(){row_dblclick_handler($(this))}),d.addSwipeEvents().bind("doubletap",function(){row_dblclick_handler($(this))})}if(0==a.lectures.length){var d=$("<tr></tr>").appendTo($("#search_result_table tbody"));$('<td colspan="13"><h2>검색 결과가 없습니다 :(</h2></td>').appendTo(d).css("text-align","center")}}function show_course_detail(a){var b=a.year,c=a.semester,d=a.course_number,e=a.lecture_number,f=null,g=null;"1"==c?(f="U000200001",g="U000300001"):"2"==c?(f="U000200002",g="U000300001"):"S"==c?(f="U000200001",g="U000300002"):"W"==c&&(f="U000200002",g="U000300002");var h="http://sugang.snu.ac.kr/sugang/cc/cc103.action?openSchyy="+b+"&openShtmFg="+f+"&openDetaShtmFg="+g+"&sbjtCd="+d+"&ltNo="+e+"&sbjtSubhCd=000";window.open(h)}String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},function(a){var b={swipeTolerance:40},c=function(b,c){this.target=a(b),this.touch=c,this.startX=this.currentX=c.screenX,this.startY=this.currentY=c.screenY,this.eventType=null};c.options={},c.latestTap=null,c.prototype.move=function(a){this.currentX=a.screenX,this.currentY=a.screenY},c.prototype.process=function(){var a=this.currentX-this.startX,b=this.currentY-this.startY;0==a&&0==b?this.checkForDoubleTap():Math.abs(b)>c.options.swipeTolerance&&Math.abs(b)>Math.abs(a)?(this.eventType=b>0?"swipedown":"swipeup",this.target.trigger("swipe",[this])):Math.abs(a)>c.options.swipeTolerance&&(this.eventType=a>0?"swiperight":"swipeleft",this.target.trigger("swipe",[this])),this.eventType&&this.target.trigger(this.eventType,[this]),this.target.trigger("touch",[this])},c.prototype.checkForDoubleTap=function(){c.latestTap&&new Date-c.latestTap<400&&(this.eventType="doubletap"),this.eventType||(this.eventType="tap"),c.latestTap=new Date};var d=function(d,e){c.options=a.extend(b,e),d.bind("touchstart",this.touchStart),d.bind("touchmove",this.touchMove),d.bind("touchcancel",this.touchCancel),d.bind("touchend",this.touchEnd)};d.prototype.touchStart=function(a){var b=this;d.eachTouch(a,function(a){d.touches[a.identifier]=new c(b,a)})},d.prototype.touchMove=function(a){d.eachTouch(a,function(a){var b=d.touches[a.identifier];b&&b.move(a)})},d.prototype.touchCancel=function(a){d.eachTouch(a,function(a){d.purge(a,!0)})},d.prototype.touchEnd=function(a){d.eachTouch(a,function(a){d.purge(a)})},d.touches={},d.purge=function(a,b){if(!b){var c=d.touches[a.identifier];c&&c.process()}delete d.touches[a.identifier]},d.eachTouch=function(a,b){for(var a=a.originalEvent,c=a.changedTouches.length,d=0;c>d;d++)b(a.changedTouches[d])},a.fn.addSwipeEvents=function(a,b){return!b&&jQuery.isFunction(a)&&(b=a,a=null),new d(this,a),b&&this.bind("touch",b),this}}(jQuery);var canvas,ctx,line_vertical=[],line_horizontal=[],line_width=3,export_image_url,bg_image;line_vertical=[0,33,53,75,95,117,138,159,180,201,221,243,263,285,305,327,348,368,390,410,431,452,473,494,515,536,557,579,600,621],line_horizontal=[0,74,182,290,397,505,613,721],$(function(){supportsToDataURL()&&(bg_image=new Image,bg_image.src="/assets/images/tt_background2.png",bg_image.onload=function(){$("#export_image_wrapper").width(bg_image.width),$("#export_image_wrapper").height(bg_image.height),canvas=document.getElementById("tt_canvas"),canvas.width=bg_image.width,canvas.height=bg_image.height,ctx=canvas.getContext("2d"),ctx.drawImage(bg_image,0,0,bg_image.width,bg_image.height),imgd=ctx.getImageData(0,0,bg_image.width,bg_image.height),pix=imgd.data})});var apiClient={get:function(a,b,c){var d="/api/";$.ajax({url:d+a,data:b,dataType:"json",method:"get",success:c})},post:function(a,b,c){var d="/api/";$.ajax({url:d+a,data:b,dataType:"json",method:"post",success:c})}},lectures=[],my_lectures=[],query_text,filter,per_page=30,page=1,page_loading_complete=!0,page_loading_requesting=!1,selected_row,my_courses_selected_row,search_result_scroll_top=0,current_tab="search",gray_color={border:"#ccc",plane:"#ddd"},colors=[{border:"#2B8728",plane:"#B6F9B2"},{border:"#45B2B8",plane:"#BFF7F8"},{border:"#1579C2",plane:"#94E6FE"},{border:"#A337A1",plane:"#F6B5F5"},{border:"#B8991B",plane:"#FFF49A"},{border:"#BA313B",plane:"#FFB2BC"}],search_type="course_title",current_year,current_semester,custom_start_cell,custom_end_cell,custom_wday,custom_start_time,custom_class_time,custom_end_cell,custom_end_time,custom_lecture_number=1,coursebook_info;$(function(){function a(a){for(var b=0;7>b&&a.next().length>0;b++)a=a.next();return a}function b(a){for(var b=0;7>b&&a.prev().length>0;b++)a=a.prev();return a}function c(a){return"mon"==a?"월":"tue"==a?"화":"wed"==a?"수":"thu"==a?"목":"fri"==a?"금":"sat"==a?"토":""}apiClient.get("init_client",{},function(a){$("#init_loading_modal").dialog("close"),coursebook_info=a.coursebook_info,current_year||current_semester||(current_year=a.last_coursebook_info.year,current_semester=a.last_coursebook_info.semester),refresh_my_courses_table(),generate_timecell(my_lectures),change_semester(current_year,current_semester),$("#semester_label").text(current_year+"-"+current_semester);var b=$("#semester_dropdown_ul");b.children().remove();for(var c=0;c<coursebook_info.length;c++){{var d=coursebook_info[c].year,e=coursebook_info[c].semester,f=$("<li></li>").appendTo(b).addClass("semester-li");$('<a href="#">'+d+"년 "+semester_to_text(e)+"</a>").attr("year",d).attr("semester",e).appendTo(f).addClass("semester-button")}d==current_year&&e==current_semester&&f.addClass("selected-semester-li")}$(".semester-button").unbind("click").click(function(){var a=$(this);if(current_year==a.attr("year")&&current_semester==a.attr("semester"))return!0;change_semester(a.attr("year"),a.attr("semester")),$(".selected-semester-li").removeClass("selected-semester-li"),a.addClass("selected-semester-li"),$("#search_result_table tbody").children().remove();var b=$("<tr></tr>").appendTo($("#search_result_table tbody"));$('<td colspan="13"><h2>검색어를 입력하세요!</h2></td>').appendTo(b).css("text-align","center"),my_lectures=[],refresh_my_courses_table(),generate_timecell(my_lectures)})}),$(".my-toggle").click(function(){window.innerWidth<768&&$(".navbar-collapse").collapse("hide")}),$("#brand_button").click(function(){return $("#nav_search_result").trigger("click"),!1}),$(window).resize(function(){selected_row?selected_row.trigger("click"):generate_timecell(my_lectures)}),$('a[data-toggle="tab"]').on("show",function(a){switch($(a.target).attr("href")){case"#my_courses":current_tab="my_courses";break;case"#search":current_tab="search";break;case"#export":current_tab="export"}}),$('a[data-toggle="tab"]').on("shown",function(a){switch($(a.target).attr("href")){case"#my_courses":generate_timecell(my_lectures);break;case"#search":$("#lectures_content").scrollTop(search_result_scroll_top)}}),$("#nav_my_courses").tooltip({placement:"bottom",trigger:"manual",title:"강의가 추가되었습니다.",animation:!1}).tooltip("show"),$(".tooltip").addClass("my-course-tooltip").hide(),$("#search_filter_toggle_button").tooltip({placement:"right",trigger:"manual",title:"강의가 추가되었습니다.",animation:!1}).tooltip("show"),$(".tooltip:last").addClass("search-filter-tooltip").hide();var d=function(a){apiClient.get("search_query",a,function(a){page_loading_requesting=!1,0==a.lectures.length&&a.page>1?page_loading_complete=!0:(set_result_table(a),$("#nav_search_result").tab("show"))})};$("#lectures_content").scroll(function(){if("search"==current_tab){var a=$(this),b=a.get(0).scrollHeight,c=a.scrollTop(),e=a.scrollTop()+a.height(),f=b-e;search_result_scroll_top=c,200>f&&!page_loading_requesting&&!page_loading_complete&&(page++,d({year:current_year,semester:current_semester,filter:filter,type:search_type,query_text:query_text,page:page,per_page:per_page}),page_loading_requesting=!0)}}),$("#search_form").submit(function(){return query_text=$("#search_query_text").val(),page=1,page_loading_complete=!1,filter=get_filter(),d({year:current_year,semester:current_semester,filter:filter,type:search_type,query_text:query_text,page:page,per_page:per_page}),cancel_lecture_selection(),!1}),$("#timetable tbody td").click(function(){cancel_lecture_selection()}),$("#search_filter_toggle_button").click(function(){var a=$(this);"off"==a.attr("state")?(a.attr("state","on").addClass("btn-info").addClass("dropup"),search_filter_tooltip_message("검색필터가 켜졌습니다."),$("#search_filter").slideDown()):(a.attr("state","off").removeClass("btn-info").removeClass("dropup"),search_filter_tooltip_message("검색필터가 꺼졌습니다."),$("#search_filter").slideUp())}),$("#search_filter").hide(),$("#search_filter .label").click(function(){var a=$(this);a.hasClass("label-info")?a.removeClass("label-info"):a.addClass("label-info")}),$("#search_filter .label").dblclick(function(){var a=$(this);a.parent().children().removeClass("label-info"),a.addClass("label-info")}).addSwipeEvents().bind("doubletap",function(){var a=$(this);a.parent().children().removeClass("label-info"),a.addClass("label-info")}),$("#search_filter .header").click(function(){var a=$(this),b=a.siblings(".label-info"),c=a.siblings(".label");c.size()==b.size()?c.removeClass("label-info"):c.addClass("label-info")}),$("body").keydown(function(c){if(34==c.keyCode&&"search"==current_tab){if(!selected_row&&lectures.length>0)$("#search_result_table tbody tr").first().trigger("click"),$("#search_query_text").blur();else if(selected_row&&a(selected_row).length>0){a(selected_row).trigger("click");var d=selected_row.position().top-selected_row.parent().position().top+26-110;$("#lectures_content").scrollTop(d),$("#search_query_text").blur()}return!1}if(33==c.keyCode&&"search"==current_tab){if(!selected_row&&lectures.length>0)$("#search_result_table tbody tr").first().trigger("click"),selected_row.addClass("selected"),$("#search_query_text").blur();else if(selected_row&&b(selected_row).length>0){b(selected_row).trigger("click");var d=selected_row.position().top-selected_row.parent().position().top+26-110;$("#lectures_content").scrollTop(d),$("#search_query_text").blur()}return!1}return 40==c.keyCode&&"search"==current_tab?(!selected_row&&lectures.length>0?($("#search_result_table tbody tr").first().trigger("click"),$("#search_query_text").blur()):selected_row&&selected_row.next().length>0&&(selected_row.next().trigger("click"),set_scroll_to_selected_row(),$("#search_query_text").blur()),!1):38==c.keyCode&&"search"==current_tab?(!selected_row&&lectures.length>0?($("#search_result_table tbody tr").first().trigger("click"),selected_row.addClass("selected"),$("#search_query_text").blur()):selected_row&&selected_row.prev().length>0&&(selected_row.prev().trigger("click"),set_scroll_to_selected_row(),$("#search_query_text").blur()),!1):40==c.keyCode&&"my_courses"==current_tab?(!my_courses_selected_row&&my_lectures.length>0?($("#my_courses_table tbody tr").first().trigger("click"),$("#search_query_text").blur()):my_courses_selected_row&&my_courses_selected_row.next().length>0&&(my_courses_selected_row.next().trigger("click"),set_scroll_to_my_courses_selected_row(),$("#search_query_text").blur()),!1):38==c.keyCode&&"my_courses"==current_tab?(!my_courses_selected_row&&my_lectures.length>0?($("#my_courses_table tbody tr").first().trigger("click"),$("#search_query_text").blur()):my_courses_selected_row&&my_courses_selected_row.prev().length>0&&(my_courses_selected_row.prev().trigger("click"),set_scroll_to_my_courses_selected_row(),$("#search_query_text").blur()),!1):void(13==c.keyCode&&"search"==current_tab?selected_row&&0==$("#search_query_text:focus").size()&&selected_row.trigger("dblclick"):13==c.keyCode&&"my_courses"==current_tab&&my_courses_selected_row&&0==$("#search_query_text:focus").size()&&my_courses_selected_row.trigger("dblclick"))
}),set_dropdown_handler(),$("#init_loading_modal").dialog({modal:!0,hide:"fade",resizable:!1,closeOnEscape:!1,dialogClass:"no-title",autoOpen:!0}),$("#facebook_loading_modal").dialog({modal:!0,resizable:!1,closeOnEscape:!1,dialogClass:"no-title",autoOpen:!1}),$("#custom_lecture_modal").dialog({modal:!0,title:"사용자정의 시간표",dialogClass:"custom-lecture-dialog",width:250,height:190,open:function(){$("#custom_course_title").val(""),$("#custom_location").val(""),cancel_lecture_selection()},close:function(){$("#customcell").hide(),custom_class_time=null},resizable:!1,autoOpen:!1}),$("#course_detail_wrapper").hide(),$("#course_detail_plan_button").click(course_detail_plan_button_handler),$("#custom_lecture_close_button").click(function(){return $("#custom_lecture_modal").dialog("close"),!1}),$("#publish_facebook_toggle_button").click(function(){var a=$(this);return"off"==a.attr("state")?(a.attr("state","on").addClass("dropup"),$("#facebook_message_wrapper").slideDown(),$("#facebook_message").focus()):(a.attr("state","off").removeClass("dropup"),$("#facebook_message").blur(),$("#facebook_message_wrapper").slideUp()),!1}),$("#facebook_message_wrapper").hide(),$("#facebook_message_wrapper").submit(function(){var a=$("#publish_facebook_ok_button");return a.attr("disabled")||(a.attr("disabled",!0),FB.login(function(b){if(b.authResponse){var c=b.authResponse.accessToken,d=$(".timetable-image").attr("src").replace(/data:image\/png;base64,/,""),e=$("#facebook_message").val();apiClient.post("publish_to_facebook",{access_token:c,base64_data:d,message:e},function(a){$("#publish_facebook_ok_button").removeAttr("disabled"),$("#facebook_loading_modal").dialog("close"),a.data.error?alert("업로드에 실패했습니다."):(alert("성공적으로 게시되었습니다!"),$("#facebook_message").val(""),$("#facebook_message_wrapper").slideUp(),$("#publish_facebook_toggle_button").attr("state","off").removeClass("dropup"))}),$("#facebook_message").blur(),$("#facebook_loading_modal").dialog("open")}else alert("페이스북 로그인에 실패했습니다."),a.removeAttr("disabled")},{scope:"publish_stream"})),!1}),$("#custom_lecture_form").submit(function(){var a=$("#custom_course_title").val(),b=$("#custom_location").val(),c={course_number:"custom",lecture_number:custom_lecture_number++,course_title:a,class_time:custom_class_time,location:b,color:generate_random_color(),credit:0};return my_lectures.push(c),refresh_my_courses_table(),generate_timecell(my_lectures),my_course_tooltip_message("강의가 추가되었습니다."),$("#custom_lecture_modal").dialog("close"),!1}),touchScroll("lectures_content"),$("#timetable tbody td").mousedown(function(){custom_start_cell=$(this),custom_wday=c(custom_start_cell.attr("class")),custom_start_time=parseFloat(custom_start_cell.attr("time"))}).mousemove(function(){if(custom_start_cell){if(custom_end_cell=$(this),custom_end_time=parseFloat(custom_end_cell.attr("time")),custom_class_time==custom_wday+"("+Math.min(custom_start_time,custom_end_time)+"-"+(Math.abs(custom_end_time-custom_start_time)+.5)+")")return!1;custom_class_time=custom_wday+"("+Math.min(custom_start_time,custom_end_time)+"-"+(Math.abs(custom_end_time-custom_start_time)+.5)+")",generate_custom_cell({class_time:custom_class_time})}return!1}),$("body").mouseup(function(){custom_end_cell&&(already_exist_class_time({class_time:custom_class_time})?(alert("강의시간이 겹칩니다."),$("#customcell").hide(),custom_class_time=null):($("#ui-dialog-title-custom_lecture_modal").text("사용자정의 시간표 - "+custom_class_time),$("#custom_lecture_modal").dialog("open"))),custom_start_cell=null,custom_end_cell=null}),$("#nav_export").click(function(){supportsToDataURL(),supportsToDataURL()?export_timetable():(alert("현재 사용중인 브라우저에선 이미지 내보내기 기능을 지원하지 않습니다."),$("#image_export_wrapper").hide()),apiClient.get("export_timetable",{year:current_year,semester:current_semester,my_lectures:my_lectures},function(a){$("#saved_timetable_url").attr("href","/user/"+a.filename).text(window.location.origin+"/user/"+a.filename)}),$("#content_wrapper").hide(),$("#social_comment_wrapper").hide(),$("#export_wrapper").show(),current_tab="export",cancel_lecture_selection()}),$("#main_navigation a").not("#nav_export").not("#nav_social_comment").not("#semester_label_button").click(function(){$("#content_wrapper").show(),$("#export_wrapper").hide(),$("#social_comment_wrapper").hide(),generate_timecell(my_lectures)}),$("#export_wrapper").hide(),$("#social_comment_wrapper").hide(),$("#nav_social_comment").click(function(){$("#content_wrapper").hide(),$("#export_wrapper").hide(),$("#social_comment_wrapper").show(),current_tab="social_comment",cancel_lecture_selection()}),$(".search-result-table").disableSelection(),$("#timetable_container").disableSelection(),$(".course_detail_toggle").click(function(){var a=($(this),$("#course_detail"));a.is(":visible")?a.slideUp():a.slideDown()})}),function(a){a.fn.disableSelection=function(){return this.each(function(){a(this).attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).each(function(){this.onselectstart=function(){return!1}})})}}(jQuery);